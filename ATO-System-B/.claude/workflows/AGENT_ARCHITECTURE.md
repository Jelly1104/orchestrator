# AGENT_ARCHITECTURE.md

> **ë¬¸ì„œ ë²„ì „**: 2.6.2
> **ìµœì¢… ì—…ë°ì´íŠ¸**: 2025-12-24
> **ë¬¼ë¦¬ì  ê²½ë¡œ**: `.claude/workflows/AGENT_ARCHITECTURE.md`
> **ë³€ê²½ ì´ë ¥**: Phase A ë‹¤ì´ì–´ê·¸ë¨ ìˆ˜ì • - Reviewer Skill ìœ„ì¹˜ë¥¼ Query Skill ì§í›„ë¡œ ì´ë™
> **ìƒìœ„ ë¬¸ì„œ**: `CLAUDE.md` > **ëŒ€ìƒ Agent**: Leader, SubAgent, AnalysisAgent, OutputValidator
> **ì°¸ê³ **: OrchestratorëŠ” Agentê°€ ì•„ë‹Œ ì›Œí¬í”Œë¡œìš° ì œì–´ ëª¨ë“ˆì…ë‹ˆë‹¤ (JavaScript í´ë˜ìŠ¤)

---

## 0. Agent ë¡œë”© ì„¤ì •

> **âš ï¸ ìš©ì–´ ì •ì˜**: ì´ ë¬¸ì„œì—ì„œ "Agent"ëŠ” LLM ê¸°ë°˜ ì—ì´ì „íŠ¸ë§Œ ì˜ë¯¸í•©ë‹ˆë‹¤.
> OrchestratorëŠ” JavaScript í´ë˜ìŠ¤ë¡œ, Agentê°€ ì•„ë‹Œ **ì›Œí¬í”Œë¡œìš° ì œì–´ ëª¨ë“ˆ**ì…ë‹ˆë‹¤.

### 0.1 ì„¹ì…˜ë³„ ë¡œë”© ëŒ€ìƒ

| ì„¹ì…˜                          | ëŒ€ìƒ                | í•„ìˆ˜ ì—¬ë¶€ |
| ----------------------------- | ------------------- | --------- |
| ì„¹ì…˜ 1 (ì•„í‚¤í…ì²˜ ê°œìš”)        | ì‚¬ìš©ì/ê°œë°œì ì°¸ì¡°  | -         |
| ì„¹ì…˜ 2 (í˜‘ì—… ì‚¬ì´í´)          | ì°¸ì¡°ìš©              | ì„ íƒ      |
| ì„¹ì…˜ 3.1 (Orchestrator ì—­í• )  | ì‚¬ìš©ì/ê°œë°œì ì°¸ì¡°  | -         |
| ì„¹ì…˜ 3.2 (Leader ì—­í• )        | Leader Agent        | í•„ìˆ˜      |
| ì„¹ì…˜ 3.3 (SubAgent ì—­í• )      | SubAgent            | í•„ìˆ˜      |
| ì„¹ì…˜ 3.4 (AnalysisAgent ì—­í• ) | AnalysisAgent       | í•„ìˆ˜      |
| ì„¹ì…˜ 4 (Multi-LLM Provider)   | ì‚¬ìš©ì/ê°œë°œì ì°¸ì¡°  | -         |
| ì„¹ì…˜ 5 (ë³´ì•ˆ ì•„í‚¤í…ì²˜)        | ëª¨ë“  Agent          | ê¶Œì¥      |
| ì„¹ì…˜ 6 (Handoff í”„ë¡œí† ì½œ)     | Leader, SubAgent    | í•„ìˆ˜      |
| ì„¹ì…˜ 7-10 (ì‚¬ìš©ë²• ë“±)         | ì‚¬ìš©ì ì°¸ì¡°ìš©       | -         |

### 0.2 ë¡œë”© ìš°ì„ ìˆœìœ„

**í•„ìˆ˜ ë¡œë”© (ëª¨ë“  ì‹¤í–‰ì—ì„œ)**

- ìì‹ ì˜ ì—­í•  ì •ì˜ ì„¹ì…˜ (3.1 / 3.2 / 3.3 / 3.4)
- Handoff í”„ë¡œí† ì½œ (ì„¹ì…˜ 6) - Leader/SubAgentë§Œ

**ì„ íƒ ë¡œë”© (í•„ìš”ì‹œ)**

- ë³´ì•ˆ ì•„í‚¤í…ì²˜ (ì„¹ì…˜ 5) - ë³´ì•ˆ ê²€ì¦ í•„ìš” ì‹œ
- ì¬ì‹œë„ ì •ì±… (ì„¹ì…˜ 10) - ì—ëŸ¬ ë°œìƒ ì‹œ

### 0.3 Agentë³„ ë¡œë”© ì˜ˆìƒ í† í°

> LLM ê¸°ë°˜ Agentë§Œ í† í°ì„ ì†Œë¹„í•©ë‹ˆë‹¤. OrchestratorëŠ” ì½”ë“œ ëª¨ë“ˆì´ë¯€ë¡œ ì œì™¸.

| Agent               | ë¡œë”© ì„¹ì…˜            | ì˜ˆìƒ í† í° |
| ------------------- | -------------------- | --------- |
| **Leader**          | ì„¹ì…˜ 3.2, ì„¹ì…˜ 6     | ~800      |
| **SubAgent**        | ì„¹ì…˜ 3.3, ì„¹ì…˜ 6     | ~600      |
| **AnalysisAgent**   | ì„¹ì…˜ 3.4             | ~500      |
| **OutputValidator** | ì„¹ì…˜ 5.1 Layer 3     | ~300      |

### 0.4 Task ID ë„¤ì´ë° ê·œì¹™

**í˜•ì‹**: `{prefix}-{keyword}-{timestamp}`

| íŒ¨í„´            | ì˜ˆì‹œ                              | ì„¤ëª…                    |
| --------------- | --------------------------------- | ----------------------- |
| Case ë¶„ì„       | `case4-active-user-1766119848270` | Case ë²ˆí˜¸ + í•µì‹¬ í‚¤ì›Œë“œ |
| ì„¤ê³„ ì¼€ì´ìŠ¤     | `recruit-agent-1766031235704`     | ê¸°ëŠ¥ëª…                  |
| í˜¼í•© ì¼€ì´ìŠ¤     | `case5-dormancy-1766037994472`    | Case ë²ˆí˜¸ + í•µì‹¬ í‚¤ì›Œë“œ |
| ê¸°ë³¸ (fallback) | `task-1766113510884`              | í‚¤ì›Œë“œ ì¶”ì¶œ ì‹¤íŒ¨ ì‹œ     |

**í‚¤ì›Œë“œ ìë™ ì¶”ì¶œ** (orchestrator.js `generateFriendlyTaskId`):

```javascript
keywords: [
  { pattern: /ì±„ìš©|recruit|job/i, name: "recruit" },
  { pattern: /íœ´ë©´|dormancy|dormant/i, name: "dormancy" },
  { pattern: /í™œì„±|active|heavy/i, name: "active-user" },
  { pattern: /ë¶„ì„|analysis|analyze/i, name: "analysis" },
  { pattern: /ì„¤ê³„|design/i, name: "design" },
  { pattern: /ì˜ˆì¸¡|predict/i, name: "predict" },
  { pattern: /ì¶”ì²œ|recommend/i, name: "recommend" },
];
```

**Viewer í‘œì‹œ ê·œì¹™** (`formatters.ts`):

- timestamp ì œì™¸í•˜ê³  ì˜ë¯¸ìˆëŠ” ì´ë¦„ë§Œ í‘œì‹œ
- ì˜ˆ: `case5-dormancy-1766037994472` â†’ `case5-dormancy`
- fallback: `task-1766113510884` â†’ `task-510884`

**ì‚°ì¶œë¬¼ ê²½ë¡œ ê·œì¹™** (SYSTEM_MANIFEST v4.3.0 ì¤€ìˆ˜, Case-Centric êµ¬ì¡°):

```
docs/cases/{caseId}/               # ì¼€ì´ìŠ¤ ì„¤ê³„ ë¬¸ì„œ (PRD, IA, SDD, Wireframe, HANDOFF)
docs/cases/{caseId}/analysis/      # ë¶„ì„ ê²°ê³¼ (SQL, JSON, ë¦¬í¬íŠ¸) âœ…
docs/cases/{caseId}/visuals/       # ì‹œê°í™” ì‚°ì¶œë¬¼ (HTML)
backend/src/{feature}/             # ë°±ì—”ë“œ êµ¬í˜„ ì½”ë“œ
frontend/src/{feature}/            # í”„ë¡ íŠ¸ì—”ë“œ êµ¬í˜„ ì½”ë“œ
workspace/logs/{task-id}.json      # ì‹¤í–‰ ë¡œê·¸
```

> âš ï¸ **Deprecated**: `workspace/analysis/{task-id}/`ëŠ” `docs/cases/{caseId}/analysis/`ë¡œ í†µí•©ë˜ì—ˆìŠµë‹ˆë‹¤.

**caseId ì¶”ì¶œ ê·œì¹™**:
- `case5-dormancy-20251223` â†’ `case5-dormancy` (ë‚ ì§œ 8ìë¦¬ ì œê±°)
- `case5-dormancy-1766037994472` â†’ `case5-dormancy` (íƒ€ì„ìŠ¤íƒ¬í”„ 13ìë¦¬ ì œê±°)

**ê¸ˆì§€ íŒ¨í„´**:

- âŒ `test-1`, `temp` (ì˜ë¯¸ì—†ëŠ” ì´ë¦„)
- âŒ íŠ¹ìˆ˜ë¬¸ì í¬í•¨ (`task@#$%`)

---

## 0.5 ì „ì²´ íŒŒì´í”„ë¼ì¸ í”Œë¡œìš° (Phase ê¸°ë°˜ HITL)

> ğŸ”´ ë¹¨ê°„ìƒ‰ ë…¸ë“œ = Human-in-the-Loop ì²´í¬í¬ì¸íŠ¸
> **Phase ì •ì˜**: README.md v4.3.2ì™€ ë™ê¸°í™”

### Phase ê°œìš”

| Phase | ì´ë¦„ | ë‹´ë‹¹ Agent | ì‚¬ìš© Skill | ì„¤ëª… | êµ¬í˜„ ìƒíƒœ |
|-------|------|------------|------------|------|-----------|
| **Phase A** | Analysis | AnalysisAgent | query, profiler | DB ë¶„ì„, SQL ì¿¼ë¦¬ ì‹¤í–‰, ë°ì´í„° ì¶”ì¶œ | âœ… êµ¬í˜„ë¨ |
| **Phase B** | Design | Leader | designer | IA.md, Wireframe.md, SDD.md, HANDOFF.md ìƒì„± | âœ… êµ¬í˜„ë¨ |
| **Phase C** | Code Implementation | SubAgent | coder | HANDOFF.md ê¸°ë°˜ ì½”ë“œ êµ¬í˜„ | â³ ë¯¸êµ¬í˜„ |
| **Phase D** | Security Layer | Orchestrator (ë‚´ë¶€) | - | ì…ë ¥ ê²€ì¦, í”„ë¡¬í”„íŠ¸ ì¸ì ì…˜ ë°©ì–´ | âœ… êµ¬í˜„ë¨ |

### ê³µí†µ Skill (Cross-Phase)

| Skill | ì‚¬ìš© ì‹œì  | í˜¸ì¶œ ì£¼ì²´ | ì„¤ëª… | êµ¬í˜„ ìƒíƒœ |
|-------|----------|----------|------|-----------|
| **reviewer** | Phase ì‚°ì¶œë¬¼ ì™„ë£Œ í›„ | Leader | í’ˆì§ˆ ê²€ì¦ (80ì  ë¯¸ë§Œ ì‹œ ì¬ì‘ì—…) | âœ… êµ¬í˜„ë¨ |
| **viewer** | HITL ì²´í¬í¬ì¸íŠ¸ | User (ì›¹ ëŒ€ì‹œë³´ë“œ) | ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§, ìŠ¹ì¸/ê±°ë¶€/í”¼ë“œë°± | âœ… êµ¬í˜„ë¨ |
| **doc-sync** | Phase ì™„ë£Œ í›„ | Leader â†’ SubAgent | Notion ë™ê¸°í™” (ì‚°ì¶œë¬¼ ì—…ë¡œë“œ) | âœ… êµ¬í˜„ë¨ |

### íŒŒì´í”„ë¼ì¸ íƒ€ì…

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Pipeline Type Selection (PRD type í•„ë“œ ê¸°ë°˜)                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  Analysis Only     â†’  Phase Aë§Œ ì‹¤í–‰                                        â”‚
â”‚  Design Only       â†’  Phase Bë§Œ ì‹¤í–‰                                        â”‚
â”‚  Mixed (ê¸°ë³¸)      â†’  Phase A â†’ Phase B ìˆœì°¨ ì‹¤í–‰                           â”‚
â”‚  Full (í–¥í›„)       â†’  Phase A â†’ Phase B â†’ Phase C ì „ì²´ ì‹¤í–‰                 â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Phase ê¸°ë°˜ íŒŒì´í”„ë¼ì¸ íë¦„

```mermaid
graph TD
    A[PRD ì…ë ¥] --> B{PRD Gap Check}
    B -- ë¶ˆì™„ì „ --> C[ğŸ§‘ HITL: PRD ë³´ì™„]
    B -- ì™„ì „ --> D[ìë™: Pipeline Type íŒë³„]

    D --> E{Pipeline Type?}

    %% Phase A: Analysis
    E -- Analysis/Mixed --> F[Phase A: AnalysisAgent]
    F --> G[Query Skill: SQL ì‹¤í–‰]
    G --> G1[Reviewer Skill: ì¿¼ë¦¬ ê²°ê³¼ ê²€ì¦]
    G1 -- FAIL --> F
    G1 -- PASS --> H{ê²°ê³¼ ì´ìƒ?}
    H -- ì´ìƒ --> I[ğŸ§‘ HITL: ì¿¼ë¦¬ ê²€í† ]
    I -.-> I1[Viewer Skill: ëŒ€ì‹œë³´ë“œ]
    H -- ì •ìƒ --> J[ë¶„ì„ ë¦¬í¬íŠ¸ ìƒì„±]
    J --> J2[Doc-Sync Skill: Notion ë™ê¸°í™”]
    J2 --> K{Mixed Pipeline?}
    K -- Yes --> L[Phase Bë¡œ ì§„í–‰]
    K -- No --> U[ì™„ë£Œ]

    %% Phase B: Design
    E -- Design Only --> L
    L --> M[Phase B: Leader Planning]
    M --> N[Designer Skill: IA/Wireframe/SDD/HANDOFF]
    N --> N1[Reviewer Skill: í’ˆì§ˆ ê²€ì¦]
    N1 -- FAIL --> M
    N1 -- PASS --> O[ğŸ§‘ HITL: ì„¤ê³„ ìŠ¹ì¸]
    O -.-> O1[Viewer Skill: ëŒ€ì‹œë³´ë“œ]
    O -- ìŠ¹ì¸ --> O2[Doc-Sync Skill: Notion ë™ê¸°í™”]
    O2 --> P{Phase C í•„ìš”?}
    O -- ìˆ˜ì •ìš”ì²­ --> M

    %% Phase C: Code Implementation (ë¯¸êµ¬í˜„)
    P -- Yes --> Q[Phase C: SubAgent êµ¬í˜„]
    P -- No --> U
    Q --> R[Coder Skill: ì½”ë“œ ì‘ì„±]
    R --> S[Reviewer Skill: Output Validation]
    S -- FAIL --> Q
    S -- PASS --> T[Leader Review]
    T -- FAIL 3íšŒ --> V[ğŸ§‘ HITL: ìˆ˜ë™ ìˆ˜ì •]
    V -.-> V1[Viewer Skill: ëŒ€ì‹œë³´ë“œ]
    T -- PASS --> T1[Doc-Sync Skill: Notion ë™ê¸°í™”]
    T1 --> W{í”„ë¡ íŠ¸ ë°°í¬?}
    W -- Yes --> X[ğŸ§‘ HITL: ë°°í¬ ìŠ¹ì¸]
    X -.-> X1[Viewer Skill: ëŒ€ì‹œë³´ë“œ]
    W -- No --> U

    style C fill:#ffcccc
    style I fill:#ffcccc
    style O fill:#ffcccc
    style V fill:#ffcccc
    style X fill:#ffcccc
    style I1 fill:#e6f3ff
    style O1 fill:#e6f3ff
    style V1 fill:#e6f3ff
    style X1 fill:#e6f3ff
    style G1 fill:#fff3cd
    style N1 fill:#fff3cd
    style S fill:#fff3cd
    style J2 fill:#d4edda
    style O2 fill:#d4edda
    style T1 fill:#d4edda
```

> **ë²”ë¡€**: ğŸ”´ ë¹¨ê°„ìƒ‰ = HITL ì²´í¬í¬ì¸íŠ¸ | ğŸ”µ íŒŒë€ìƒ‰ = Viewer Skill | ğŸŸ¡ ë…¸ë€ìƒ‰ = Reviewer Skill | ğŸŸ¢ ì´ˆë¡ìƒ‰ = Doc-Sync Skill

### HITL ì²´í¬í¬ì¸íŠ¸ ìš”ì•½

| ì²´í¬í¬ì¸íŠ¸    | Phase | íŠ¸ë¦¬ê±° ì¡°ê±´                                  | ì¸ê°„ ì•¡ì…˜                    |
| ------------- | ----- | -------------------------------------------- | ---------------------------- |
| **PRD ë³´ì™„**  | ì§„ì… ì „ | PRD Gap Check ë¶ˆì™„ì „ (í•„ìˆ˜ í•­ëª© ëˆ„ë½)        | PRD í•„ìˆ˜ í•­ëª© ë³´ì™„ í›„ ì¬ì‹œì‘ |
| **ì¿¼ë¦¬ ê²€í† ** | A    | SQL ê²°ê³¼ ì´ìƒ (0í–‰, íƒ€ì„ì•„ì›ƒ, ìŠ¤í‚¤ë§ˆ ë¶ˆì¼ì¹˜) | ì¿¼ë¦¬ ìˆ˜ì • ë˜ëŠ” ìŠ¹ì¸          |
| **ì„¤ê³„ ìŠ¹ì¸** | B    | IA/Wireframe/SDD ìƒì„± ì™„ë£Œ                   | ì„¤ê³„ ê²€í†  ë° ìŠ¹ì¸/ìˆ˜ì •ìš”ì²­   |
| **ìˆ˜ë™ ìˆ˜ì •** | C    | 3íšŒ ì—°ì† Review FAIL                         | ì§ì ‘ ìˆ˜ì • ë˜ëŠ” ë°©í–¥ ì¡°ì •     |
| **ë°°í¬ ìŠ¹ì¸** | C    | í”„ë¡ íŠ¸ì—”ë“œ ë°°í¬ í•„ìš” ì‹œ                      | ìµœì¢… ë°°í¬ ìŠ¹ì¸               |

### ìë™ ì¤‘ë‹¨ íŠ¸ë¦¬ê±°

```yaml
PRD Gap Check:
  - í•„ìˆ˜ 6ê°œ í•­ëª© ì¤‘ ëˆ„ë½ ì¡´ì¬
  - type/pipeline ë¶ˆì¼ì¹˜

Phase A (SQL ê²°ê³¼ ê²€ì¦):
  - ê²°ê³¼ í–‰ 0ê°œ
  - ì¿¼ë¦¬ íƒ€ì„ì•„ì›ƒ (30ì´ˆ ì´ˆê³¼)
  - DOMAIN_SCHEMA.mdì™€ ì»¬ëŸ¼ ë¶ˆì¼ì¹˜

Phase C (Output Validation):
  - PRD ì²´í¬ë¦¬ìŠ¤íŠ¸ ë§¤ì¹­ë¥  < 80%
  - ë³´ì•ˆ ê²Œì´íŠ¸ ìœ„ë°˜ (Protected Path ì ‘ê·¼)
  - ì¬ì‹œë„ íšŸìˆ˜ >= 3íšŒ
```

---

## 0.6 Skill-Agent ë§¤í•‘ (ë„êµ¬ ê·œì •)

> **Source of Truth**: `SYSTEM_MANIFEST.md`ì˜ Skill Registry ë° `orchestrator/skills/README.md`ì™€ ë™ê¸°í™”
> ê° Agentê°€ ì‚¬ìš© ê°€ëŠ¥í•œ Skillì„ ëª…í™•íˆ ê·œì •í•©ë‹ˆë‹¤.

### Skill vs Agent ê°œë… ì •ë¦¬

> **ë„¤ì´ë° ê·œì¹™ (v2.5.0)**: Skill ì´ë¦„ì—ì„œ `-agent` ì ‘ë¯¸ì‚¬ ì œê±°. `agent`ëŠ” LLM ê¸°ë°˜ ì‹¤í–‰ ì£¼ì²´ì—ë§Œ ì‚¬ìš©.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Skillê³¼ Agentì˜ ê´€ê³„                                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  Skill (skills/*/SKILL.md)              Agent (agents/*.js)                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€              â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€               â”‚
â”‚  â€¢ ëŠ¥ë ¥/ì—­í•  ì •ì˜ì„œ                      â€¢ LLM ê¸°ë°˜ ì‹¤í–‰ ì£¼ì²´                  â”‚
â”‚  â€¢ í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿                       â€¢ Claude API í˜¸ì¶œ                     â”‚
â”‚  â€¢ ì…ì¶œë ¥ ìŠ¤í‚¤ë§ˆ ì •ì˜                    â€¢ Skillì„ ë¡œë“œí•˜ì—¬ ì‚¬ìš©                â”‚
â”‚                                                                             â”‚
â”‚  ì˜ˆì‹œ:                                                                       â”‚
â”‚  AnalysisAgent (agents/analysis-agent.js)                                   â”‚
â”‚    â””â”€â”€ query Skill (skills/query/SKILL.md) ë¡œë“œ                             â”‚
â”‚    â””â”€â”€ profiler Skill (skills/profiler/SKILL.md) ë¡œë“œ                       â”‚
â”‚                                                                             â”‚
â”‚  âš ï¸ Skill ìì²´ëŠ” Agentê°€ ì•„ë‹™ë‹ˆë‹¤. Agentê°€ Skillì„ ì‚¬ìš©í•©ë‹ˆë‹¤.                 â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Skill ëª©ë¡ ë° í˜¸ì¶œ Agent

| Skill | Version | í˜¸ì¶œ Agent | Phase | ì£¼ìš” ê¸°ëŠ¥ |
|-------|---------|------------|-------|-----------|
| **query** | v1.2.0 | AnalysisAgent | A | SQL ì¿¼ë¦¬ ì‘ì„± ë° ì‹¤í–‰, ë°ì´í„° ì¶”ì¶œ |
| **profiler** | v1.2.0 | AnalysisAgent | A | ì‚¬ìš©ì í”„ë¡œíŒŒì¼ ë¶„ì„, ì„¸ê·¸ë¨¼íŠ¸ ë¶„ë¥˜ |
| **designer** | v2.2.0 | Leader | B | ì‹œê°í™” ê³ ë„í™” (Mermaid â†’ HTML) |
| **doc-sync** | v2.1.0 | Leader | B | ë¡œì»¬ â†” Notion ë™ê¸°í™” |
| **coder** | v1.3.0 | SubAgent | C | ì½”ë“œ êµ¬í˜„ (backend/frontend) |
| **reviewer** | v1.2.0 | OutputValidator | C | ì‚°ì¶œë¬¼ í’ˆì§ˆ ê²€ì¦, PASS/FAIL |
| **viewer** | v1.5.0 | (Orchestrator) | - | ì›¹ ë·°ì–´ API (LLM ë¯¸ì‚¬ìš©) |

> **ì°¸ê³ **: viewerëŠ” ìˆœìˆ˜ JavaScript ìœ í‹¸ë¦¬í‹°ë¡œ, LLM Agentê°€ ì•„ë‹™ë‹ˆë‹¤.

### Agent-Skill ê¶Œí•œ ë§¤íŠ¸ë¦­ìŠ¤

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Agent-Skill ê¶Œí•œ ë§¤íŠ¸ë¦­ìŠ¤                                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                   â”‚
â”‚                 query  profiler  designer  doc-sync  coder  reviewer  viewer     â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  Orchestrator     -       -          -         -        -       -       âœ…       â”‚
â”‚  Leader           -       -          âœ…        âœ…       -       âœ…      -        â”‚
â”‚  SubAgent         -       -          -         âœ…       âœ…      -       -        â”‚
â”‚  AnalysisAgent    âœ…      âœ…         -         -        -       -       -        â”‚
â”‚  User (HITL)      -       -          -         -        -       -       âœ…       â”‚
â”‚                                                                                   â”‚
â”‚  âœ… = ì‚¬ìš© ê°€ëŠ¥ / - = ì‚¬ìš© ë¶ˆê°€                                                     â”‚
â”‚                                                                                   â”‚
â”‚  ì‚¬ìš© ì‹œì :                                                                        â”‚
â”‚  â€¢ reviewer: Phase ì‚°ì¶œë¬¼ ì™„ë£Œ í›„ í’ˆì§ˆ ê²€ì¦ (Leaderê°€ í˜¸ì¶œ)                         â”‚
â”‚  â€¢ doc-sync: Phase ì™„ë£Œ + HITL ìŠ¹ì¸ í›„ Notion ë™ê¸°í™” (Leaderâ†’SubAgent ì§€ì‹œ)        â”‚
â”‚  â€¢ viewer: HITL ì²´í¬í¬ì¸íŠ¸ì—ì„œ Userê°€ ëŒ€ì‹œë³´ë“œë¡œ ëª¨ë‹ˆí„°ë§/ìŠ¹ì¸/ê±°ë¶€                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ì™œ LeaderëŠ” DBì— ì§ì ‘ ì ‘ì†í•˜ì§€ ì•ŠëŠ”ê°€?

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ”’ ì—­í•  ë¶„ë¦¬ ì›ì¹™ (Separation of Concerns)                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  Leader Agentì˜ ì—­í• :                                                        â”‚
â”‚  â”œâ”€â”€ ì„¤ê³„ì (Architect): ì „ì²´ êµ¬ì¡° ì„¤ê³„, IA/SDD ìƒì„±                          â”‚
â”‚  â”œâ”€â”€ ì¡°ìœ¨ì (Coordinator): SubAgent ì‘ì—… ì§€ì‹œ, HANDOFF ìƒì„±                   â”‚
â”‚  â””â”€â”€ ê²€ì¦ì (Reviewer): ì‚°ì¶œë¬¼ ê²€í† , PASS/FAIL íŒì •                           â”‚
â”‚                                                                             â”‚
â”‚  Leaderê°€ DB ì ‘ì†í•˜ì§€ ì•ŠëŠ” ì´ìœ :                                              â”‚
â”‚  1. ë‹¨ì¼ ì±…ì„ ì›ì¹™ (SRP): ì„¤ê³„/ì¡°ìœ¨ê³¼ ë°ì´í„° ë¶„ì„ì€ ë³„ê°œ ê´€ì‹¬ì‚¬                   â”‚
â”‚  2. ë³´ì•ˆ ë¶„ë¦¬: DB ì ‘ê·¼ ê¶Œí•œì€ AnalysisAgentì—ë§Œ ë¶€ì—¬ (Query Skill ì‚¬ìš©)         â”‚
â”‚  3. í† í° íš¨ìœ¨ì„±: LeaderëŠ” ì„¤ê³„ ì»¨í…ìŠ¤íŠ¸ë§Œ ë¡œë“œ, DB ìŠ¤í‚¤ë§ˆ ë¶ˆí•„ìš”                  â”‚
â”‚  4. ê°ì‚¬ ì¶”ì : DB ì¿¼ë¦¬ëŠ” AnalysisAgentë¥¼ í†µí•´ì„œë§Œ ì‹¤í–‰ â†’ ë¡œê¹… ì¼ì›í™”            â”‚
â”‚                                                                             â”‚
â”‚  ë°ì´í„°ê°€ í•„ìš”í•  ë•Œ:                                                          â”‚
â”‚  PRD â†’ Orchestrator â†’ AnalysisAgent (Phase A) â†’ ë¶„ì„ ê²°ê³¼ â†’ Leader (Phase B) â”‚
â”‚                                                                             â”‚
â”‚  âš ï¸ Leaderê°€ ì§ì ‘ SELECT ì¿¼ë¦¬ë¥¼ ì‘ì„±/ì‹¤í–‰í•˜ëŠ” ê²ƒì€ ì•„í‚¤í…ì²˜ ìœ„ë°˜ì…ë‹ˆë‹¤.          â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 1. ì•„í‚¤í…ì²˜ ê°œìš”

### 1.1 í•µì‹¬ ì›ì¹™

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ¯ Orchestrator ì¤‘ì‹¬ ì•„í‚¤í…ì²˜ ì›ì¹™                                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  1. Orchestrator = ë‹¨ì¼ ì œì–´ì  (Single Control Point)                        â”‚
â”‚     â€¢ ëª¨ë“  ì—ì´ì „íŠ¸ ì‹¤í–‰ì€ Orchestratorë¥¼ í†µí•´ì„œë§Œ ë°œìƒ                           â”‚
â”‚     â€¢ MCP Server ë¶ˆí•„ìš” - ì§ì ‘ API í˜¸ì¶œ ë°©ì‹                                    â”‚
â”‚                                                                             â”‚
â”‚  2. Multi-LLM Provider ì§€ì›                                                  â”‚
â”‚     â€¢ Claude (Primary) â†’ GPT-4 â†’ Gemini (Fallback Chain)                    â”‚
â”‚     â€¢ ì•„í‚¤í…ì²˜ ë³€ê²½ ì—†ì´ LLM êµì²´ ê°€ëŠ¥                                           â”‚
â”‚                                                                             â”‚
â”‚  3. ë³´ì•ˆ ìš°ì„  (Security First)                                               â”‚
â”‚     â€¢ ì…ë ¥ ê²€ì¦ (Path Traversal, Prompt Injection ë°©ì–´)                       â”‚
â”‚     â€¢ ì¶œë ¥ ê²€ì¦ (Protected Path ë³´í˜¸)                                         â”‚
â”‚     â€¢ ê°ì‚¬ ë¡œê¹… (Audit Trail)                                                â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 ì‹œìŠ¤í…œ ë‹¤ì´ì–´ê·¸ë¨ (Phase ê¸°ë°˜)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Orchestrator-Centric Multi-LLM Architecture (v4.0.0)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“¥ INPUT                                                                   â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  â€¢ PRD (.claude/project/PRD.md)                                             â”‚
â”‚  â€¢ ì‚¬ìš©ì ìš”ì²­ (ìì—°ì–´)                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ›ï¸ ORCHESTRATOR (orchestrator.js) - ì›Œí¬í”Œë¡œìš° ì œì–´ ëª¨ë“ˆ                      â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â”‚
â”‚  â€¢ PRD íŒŒì‹± â†’ Pipeline Type ê²°ì • (Analysis/Design/Mixed/Full)               â”‚
â”‚  â€¢ Phaseì— ë§ëŠ” Agent í˜¸ì¶œ                                                   â”‚
â”‚  â€¢ HITL ì²´í¬í¬ì¸íŠ¸ ê´€ë¦¬                                                       â”‚
â”‚  â€¢ Security Layer (ì…ë ¥ ê²€ì¦, Rate Limiting)                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚                                                                 â”‚
          â–¼ [Phase A: Analysis]                                             â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                     â”‚
â”‚  ğŸ“Š ANALYSIS AGENT                  â”‚                                     â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚                                     â”‚
â”‚  â€¢ SQL ì¿¼ë¦¬ ì‘ì„±/ì‹¤í–‰                 â”‚                                     â”‚
â”‚  â€¢ ë°ì´í„° ì¶”ì¶œ ë° ë¶„ì„                â”‚                                     â”‚
â”‚  â€¢ ë¶„ì„ ë¦¬í¬íŠ¸ ìƒì„±                   â”‚                                     â”‚
â”‚                                     â”‚                                     â”‚
â”‚  Skill: query, profiler             â”‚                                     â”‚
â”‚  Output: analysis/*.sql, *.json     â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                     â”‚
          â”‚                                                                 â”‚
          â–¼ [Phase B: Design]                                               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                     â”‚
â”‚  ğŸ§  LEADER AGENT                    â”‚                                     â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚                                     â”‚
â”‚  [Planning Mode]                    â”‚                                     â”‚
â”‚  â€¢ ìš”êµ¬ì‚¬í•­ ë¶„ì„                      â”‚                                     â”‚
â”‚  â€¢ IA.md / Wireframe.md ìƒì„±        â”‚                                     â”‚
â”‚  â€¢ SDD.md / HANDOFF.md ìƒì„±         â”‚                                     â”‚
â”‚                                     â”‚                                     â”‚
â”‚  Skill: designer, doc-sync          â”‚                                     â”‚
â”‚  Output: docs/cases/{caseId}/*.md   â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                     â”‚
          â”‚                                                                 â”‚
          â–¼ [Phase C: Implementation] â³ ë¯¸êµ¬í˜„                               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                     â”‚
â”‚  âš™ï¸ SUB-AGENT                       â”‚                                     â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚                                     â”‚
â”‚  [Coding Mode]                      â”‚                                     â”‚
â”‚  â€¢ HANDOFF.md ê¸°ë°˜ ì½”ë“œ êµ¬í˜„          â”‚                                     â”‚
â”‚  â€¢ í…ŒìŠ¤íŠ¸ ì‘ì„±                        â”‚                                     â”‚
â”‚                                     â”‚                                     â”‚
â”‚  Skill: coder                       â”‚                                     â”‚
â”‚  Output: backend/src/*, frontend/*  â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                     â”‚
          â”‚                                                                 â”‚
          â–¼ [Review Loop] â³ ë¯¸êµ¬í˜„                                          â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                     â”‚
â”‚  ğŸ” LEADER (Review Mode)            â”‚â”€â”€â”€â”€ FAIL (ìµœëŒ€ 3íšŒ) â”€â”€â”€â”€â”            â”‚
â”‚  â€¢ ì½”ë“œ ë¦¬ë·°                          â”‚                        â”‚            â”‚
â”‚  â€¢ VALIDATION_GUIDE ê²€ì¦             â”‚                        â–¼            â”‚
â”‚  â€¢ PASS/FAIL íŒì •                    â”‚â—„â”€â”€â”€ í”¼ë“œë°± ë°˜ì˜ â—„â”€â”€ SubAgent        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                     â”‚
          â”‚ PASS                                                            â”‚
          â–¼                                                                 â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“¤ OUTPUT                                                                  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                             â”‚
â”‚  [Phase A ì‚°ì¶œë¬¼]                    [Phase B ì‚°ì¶œë¬¼]                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ docs/cases/{id}/analysis/â”‚        â”‚ docs/cases/{id}/        â”‚            â”‚
â”‚  â”‚ â”œâ”€â”€ query.sql           â”‚        â”‚ â”œâ”€â”€ PRD.md (ìŠ¤ëƒ…ìƒ·)      â”‚            â”‚
â”‚  â”‚ â”œâ”€â”€ result.json         â”‚        â”‚ â”œâ”€â”€ IA.md               â”‚            â”‚
â”‚  â”‚ â””â”€â”€ report.md           â”‚        â”‚ â”œâ”€â”€ Wireframe.md        â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚ â”œâ”€â”€ SDD.md              â”‚            â”‚
â”‚                                     â”‚ â””â”€â”€ HANDOFF.md          â”‚            â”‚
â”‚  [Phase C ì‚°ì¶œë¬¼] â³ ë¯¸êµ¬í˜„           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                               â”‚
â”‚  â”‚ backend/src/{feature}/  â”‚        [ë¡œê·¸]                                  â”‚
â”‚  â”‚ frontend/src/{feature}/ â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ **/tests/*.test.ts      â”‚        â”‚ workspace/logs/{id}.jsonâ”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. í˜‘ì—… ì‚¬ì´í´

> **ìƒì„¸ í”Œë¡œìš°**: ì„¹ì…˜ 0.5 "ì „ì²´ íŒŒì´í”„ë¼ì¸ í”Œë¡œìš° (Phase ê¸°ë°˜ HITL)" ì°¸ì¡°

---

## 3. ì—­í•  ì •ì˜

### 3.1 Orchestrator (orchestrator.js) - ì›Œí¬í”Œë¡œìš° ì œì–´ ëª¨ë“ˆ

> **âš ï¸ ì£¼ì˜**: OrchestratorëŠ” LLM Agentê°€ ì•„ë‹™ë‹ˆë‹¤. (ì„¹ì…˜ 0 ìš©ì–´ ì •ì˜ ì°¸ì¡°)

| í•­ëª©     | ë‚´ìš©                                                |
| -------- | --------------------------------------------------- |
| **íƒ€ì…** | JavaScript í´ë˜ìŠ¤ (NOT LLM Agent)                   |
| **ì—­í• ** | ì „ì²´ ì œì–´ + ë³´ì•ˆ ê²Œì´íŠ¸ì›¨ì´                         |
| **ë‹´ë‹¹** | PRD íŒŒì‹±, Agent í˜¸ì¶œ, HITL ê´€ë¦¬, ì¬ì‹œë„, ë¡œê·¸ ì €ì¥  |
| **ë³´ì•ˆ** | Rate Limiting, Path Traversal ë°©ì§€, ì…ë ¥ ìƒˆë‹ˆíƒ€ì´ì§• |
| **í˜¸ì¶œ** | Leader, SubAgent, AnalysisAgentë¥¼ ìƒì„±í•˜ê³  í˜¸ì¶œ     |

### 3.2 Leader Agent (leader.js)

| í•­ëª©     | ë‚´ìš©                                                     |
| -------- | -------------------------------------------------------- |
| **ì—­í• ** | ì„¤ê³„ì + ê²€ì¦ì                                          |
| **Mode** | Planning Mode, Review Mode                               |
| **ë‹´ë‹¹** | IA/Wireframe/SDD/HANDOFF ìƒì„±, ì½”ë“œ ë¦¬ë·°, PASS/FAIL íŒì • |
| **ë³´ì•ˆ** | Prompt Injection ë°©ì–´ (wrapUserContent)                  |
| **ê¶Œí•œ** | `.claude/project/*` ìˆ˜ì • ê°€ëŠ¥                            |

### 3.3 Sub-agent (subagent.js)

| í•­ëª©     | ë‚´ìš©                                                           |
| -------- | -------------------------------------------------------------- |
| **ì—­í• ** | êµ¬í˜„ì                                                         |
| **Mode** | Coding Mode                                                    |
| **ë‹´ë‹¹** | ì½”ë“œ ì‘ì„±, í…ŒìŠ¤íŠ¸ ì‘ì„±                                         |
| **ë³´ì•ˆ** | Output Validation (Protected Path ë³´í˜¸)                        |
| **ê¶Œí•œ** | `backend/src/*`, `frontend/src/*`, `mcp-server/*` ìˆ˜ì • ê°€ëŠ¥    |
| **ì œì•½** | `.claude/{rules, workflows, context}/*`, `orchestrator/` ìˆ˜ì • ê¸ˆì§€ |

### 3.4 AnalysisAgent (ë°ì´í„° ë¶„ì„ê°€)

> **Phase A ì „ë‹´**: ëª¨ë“  ë°ì´í„°ë² ì´ìŠ¤ ë¶„ì„ ì‘ì—…ì€ AnalysisAgentë¥¼ í†µí•´ì„œë§Œ ìˆ˜í–‰ë©ë‹ˆë‹¤.

| í•­ëª©       | ë‚´ìš©                                                              |
| ---------- | ----------------------------------------------------------------- |
| **ì—­í• **   | ë°ì´í„° ë¶„ì„ê°€ (Data Analyst)                                      |
| **Phase**  | Phase A (Analysis)                                                |
| **ë‹´ë‹¹**   | SQL ì¿¼ë¦¬ ì‘ì„±/ì‹¤í–‰, ë°ì´í„° ì¶”ì¶œ, ë¶„ì„ ë¦¬í¬íŠ¸ ìƒì„±                 |
| **Skill**  | `query`, `profiler`                                               |
| **ë³´ì•ˆ**   | SELECT ì¿¼ë¦¬ë§Œ í—ˆìš©, INSERT/UPDATE/DELETE ê¸ˆì§€                    |
| **ê¶Œí•œ**   | `docs/cases/{caseId}/analysis/*` ì“°ê¸° ê°€ëŠ¥                        |
| **ì œì•½**   | í”„ë¡œë•ì…˜ DB ì§ì ‘ ìˆ˜ì • ê¸ˆì§€, ë¡œì»¬ ì‘ì—…ë§Œ í—ˆìš©                      |

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AnalysisAgent ì‘ì—… íë¦„                                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  INPUT                                                                      â”‚
â”‚  â”œâ”€â”€ PRD (ë¶„ì„ ìš”êµ¬ì‚¬í•­)                                                     â”‚
â”‚  â”œâ”€â”€ DOMAIN_SCHEMA.md (í…Œì´ë¸”/ì»¬ëŸ¼ ì •ì˜)                                     â”‚
â”‚  â””â”€â”€ DB_ACCESS_POLICY.md (ì ‘ê·¼ ê¶Œí•œ)                                        â”‚
â”‚                                                                             â”‚
â”‚  PROCESS                                                                    â”‚
â”‚  â”œâ”€â”€ 1. PRDì—ì„œ ë¶„ì„ ëª©í‘œ ì¶”ì¶œ                                               â”‚
â”‚  â”œâ”€â”€ 2. DOMAIN_SCHEMA.md ì°¸ì¡°í•˜ì—¬ SQL ì‘ì„±                                   â”‚
â”‚  â”œâ”€â”€ 3. Query Skillë¡œ SQL ì‹¤í–‰                                              â”‚
â”‚  â”œâ”€â”€ 4. ê²°ê³¼ ê²€ì¦ (í–‰ ìˆ˜, ìŠ¤í‚¤ë§ˆ ì¼ì¹˜)                                       â”‚
â”‚  â””â”€â”€ 5. ë¶„ì„ ë¦¬í¬íŠ¸ ìƒì„±                                                     â”‚
â”‚                                                                             â”‚
â”‚  OUTPUT                                                                     â”‚
â”‚  â”œâ”€â”€ docs/cases/{caseId}/analysis/query.sql                                 â”‚
â”‚  â”œâ”€â”€ docs/cases/{caseId}/analysis/result.json                               â”‚
â”‚  â””â”€â”€ docs/cases/{caseId}/analysis/report.md                                 â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**âš ï¸ í•µì‹¬ ì›ì¹™**: Leader AgentëŠ” DBì— ì§ì ‘ ì ‘ì†í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
- ë°ì´í„° ë¶„ì„ì´ í•„ìš”í•œ ê²½ìš°, Orchestratorê°€ AnalysisAgentë¥¼ Phase Aì—ì„œ ë¨¼ì € ì‹¤í–‰
- AnalysisAgentì˜ ë¶„ì„ ê²°ê³¼ëŠ” `docs/cases/{caseId}/analysis/`ì— ì €ì¥
- LeaderëŠ” Phase Bì—ì„œ ì´ ë¶„ì„ ê²°ê³¼ë¥¼ ì°¸ì¡°í•˜ì—¬ ì„¤ê³„ ì§„í–‰

---

## 4. Multi-LLM Provider íŒ¨í„´

### 4.1 Provider êµ¬ì¡°

```
orchestrator/providers/
â”œâ”€â”€ base.js          # ì¶”ìƒ ì¸í„°í˜ì´ìŠ¤
â”œâ”€â”€ anthropic.js     # Claude API (Primary)
â”œâ”€â”€ openai.js        # GPT-4 API (Fallback #1)
â”œâ”€â”€ gemini.js        # Gemini API (Fallback #2)
â”œâ”€â”€ factory.js       # Provider Factory + Fallback Chain
â””â”€â”€ index.js         # í†µí•© ë‚´ë³´ë‚´ê¸°
```

### 4.2 Fallback Chain

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ”„ Provider Fallback Chain                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     FAIL     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     FAIL     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚    â”‚   Claude     â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º  â”‚    GPT-4     â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º  â”‚ Gemini  â”‚ â”‚
â”‚    â”‚  (Primary)   â”‚              â”‚ (Fallback 1) â”‚              â”‚ (FB 2)  â”‚ â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚           â”‚                             â”‚                           â”‚      â”‚
â”‚           â–¼                             â–¼                           â–¼      â”‚
â”‚        SUCCESS                       SUCCESS                     SUCCESS   â”‚
â”‚                                                                             â”‚
â”‚    í™˜ê²½ë³€ìˆ˜:                                                                  â”‚
â”‚    â€¢ ANTHROPIC_API_KEY (Claude)                                             â”‚
â”‚    â€¢ OPENAI_API_KEY (GPT-4)                                                 â”‚
â”‚    â€¢ GOOGLE_API_KEY (Gemini)                                                â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.3 Provider ì„¤ì •

```javascript
// orchestrator.js ìƒì„±ì
const orchestrator = new Orchestrator({
  provider: "anthropic", // Primary provider
  fallbackOrder: ["anthropic", "openai", "gemini"],
  useFallback: true, // Fallback í™œì„±í™”
  providerConfig: {
    anthropic: { model: "claude-sonnet-4-20250514" },
    openai: { model: "gpt-4-turbo-preview" },
    gemini: { model: "gemini-pro" },
  },
});
```

---

## 5. ë³´ì•ˆ ì•„í‚¤í…ì²˜ (v3.2.0)

### 5.1 ë³´ì•ˆ ê³„ì¸µ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ”’ Security Layers                                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  Layer 1: Input Validation (Orchestrator)                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ â€¢ validateTaskId()     : ../../../ ì°¨ë‹¨, íŠ¹ìˆ˜ë¬¸ì ì œí•œ                    â”‚  â”‚
â”‚  â”‚ â€¢ sanitizeTaskDescription() : 10,000ì ì œí•œ                             â”‚  â”‚
â”‚  â”‚ â€¢ sanitizePrdContent() : 50,000ì ì œí•œ                                  â”‚  â”‚
â”‚  â”‚ â€¢ validateFilePath()   : projectRoot ì™¸ë¶€ ê²½ë¡œ ì°¨ë‹¨                      â”‚  â”‚
â”‚  â”‚ â€¢ checkRateLimit()     : 20íšŒ/ì‹œê°„ ì œí•œ                                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                             â”‚
â”‚  Layer 2: Prompt Injection Defense (Leader)                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ â€¢ DANGEROUS_PATTERNS í•„í„°ë§:                                            â”‚  â”‚
â”‚  â”‚   - ignore previous instructions                                       â”‚  â”‚
â”‚  â”‚   - disregard all rules                                                â”‚  â”‚
â”‚  â”‚   - you are now                                                        â”‚  â”‚
â”‚  â”‚   - system prompt                                                      â”‚  â”‚
â”‚  â”‚ â€¢ wrapUserContent(): ê²½ê³„ ë§ˆì»¤ë¡œ ì‚¬ìš©ì ì…ë ¥ ê²©ë¦¬                          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                             â”‚
â”‚  Layer 3: Output Validation (Sub-agent)                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ â€¢ Path Traversal ê±°ë¶€ (../)                                            â”‚  â”‚
â”‚  â”‚ â€¢ Absolute Path ê±°ë¶€ (/etc/passwd)                                     â”‚  â”‚
â”‚  â”‚ â€¢ Protected Path ê±°ë¶€ (.claude/rules/*, .claude/workflows/*)           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                             â”‚
â”‚  Layer 4: Audit & Integrity (Utils)                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ â€¢ AuditLogger: ë³´ì•ˆ ì´ë²¤íŠ¸ ì¶”ì , ë¯¼ê°ì •ë³´ ë§ˆìŠ¤í‚¹                           â”‚  â”‚
â”‚  â”‚ â€¢ RulebookValidator: .claude/rules/*, workflows/* SHA256 í•´ì‹œ ê²€ì¦   â”‚  â”‚
â”‚  â”‚ â€¢ HandoffValidator: HANDOFF í”„ë¡œí† ì½œ ìŠ¤í‚¤ë§ˆ + ë³´ì•ˆ ê²€ì¦                   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 ë³´ì•ˆ ìœ í‹¸ë¦¬í‹°

```
orchestrator/utils/
â”œâ”€â”€ audit-logger.js       # ê°ì‚¬ ë¡œê¹… (ë¯¼ê°ì •ë³´ ë§ˆìŠ¤í‚¹)
â”œâ”€â”€ rulebook-validator.js # ë£°ë¶ í•´ì‹œ ë¬´ê²°ì„± ê²€ì¦
â”œâ”€â”€ handoff-validator.js  # HANDOFF í”„ë¡œí† ì½œ ê²€ì¦
â””â”€â”€ index.js              # í†µí•© ë‚´ë³´ë‚´ê¸°
```

| ìœ í‹¸ë¦¬í‹°              | ì—­í•                                                    |
| --------------------- | ------------------------------------------------------ |
| **AuditLogger**       | ë³´ì•ˆ ì´ë²¤íŠ¸ ê¸°ë¡, API í‚¤/ì´ë©”ì¼ ë§ˆìŠ¤í‚¹                 |
| **RulebookValidator** | ë£°ë¶ í´ë”(`rules`, `workflows`, `context`) ë¬´ê²°ì„± ê²€ì¦ |
| **HandoffValidator**  | HANDOFF í•„ìˆ˜ ì„¹ì…˜ í™•ì¸, ì•…ì˜ì  ì§€ì‹œ í•„í„°ë§             |

---

## 6. Handoff í”„ë¡œí† ì½œ

### 6.1 Leader â†’ Sub-agent (HANDOFF.md)

```markdown
## Mode

Coding

## Input

- docs/task-1/IA.md
- docs/task-1/SDD.md
- DOMAIN_SCHEMA.md

## Output

- backend/src/features/login/index.ts
- backend/tests/login.test.ts

## Constraints

- TypeScript í•„ìˆ˜
- TDD ë°©ì‹
- DOMAIN_SCHEMA.md ì»¬ëŸ¼ëª… ì¤€ìˆ˜

## CompletionCriteria

- ë¹Œë“œ ì„±ê³µ
- í…ŒìŠ¤íŠ¸ PASS
```

### 6.2 Sub-agent â†’ Leader (ì™„ë£Œ ë³´ê³ )

```markdown
## ì™„ë£Œ ë³´ê³ : login-feature

### ìƒì„±ëœ íŒŒì¼

- backend/src/features/login/index.ts
- backend/tests/login.test.ts

### ì‹¤í–‰ ê²°ê³¼

- í…ŒìŠ¤íŠ¸: PASS (5/5)
- íƒ€ì…ì²´í¬: PASS

### ì´ìŠˆ

- ì—†ìŒ
```

### 6.3 HandoffValidator ê²€ì¦ í•­ëª©

| ê²€ì¦          | ë‚´ìš©                                          |
| ------------- | --------------------------------------------- |
| **í•„ìˆ˜ ì„¹ì…˜** | Mode, Input, Output, Constraints              |
| **Mode ê°’**   | coding, review, test, refactor, debug ì¤‘ í•˜ë‚˜ |
| **ë³´ì•ˆ íŒ¨í„´** | "ignore previous", "bypass security" ë“± ì°¨ë‹¨  |

---

## 7. íŒŒì¼ êµ¬ì¡°

```
ATO-System-B/
â”œâ”€â”€ .claude/
â”‚   â”œâ”€â”€ rules/ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ğŸ”´ READ ONLY (Constraint Layer)
â”‚   â”‚   â”œâ”€â”€ CODE_STYLE.md
â”‚   â”‚   â”œâ”€â”€ DOMAIN_SCHEMA.md
â”‚   â”‚   â”œâ”€â”€ DB_ACCESS_POLICY.md
â”‚   â”‚   â”œâ”€â”€ VALIDATION_GUIDE.md
â”‚   â”‚   â”œâ”€â”€ TDD_WORKFLOW.md
â”‚   â”‚   â””â”€â”€ ANALYSIS_GUIDE.md
â”‚   â”‚
â”‚   â”œâ”€â”€ workflows/ â”€â”€â”€â”€â”€â”€â”€â”€â”€ ğŸ”´ READ ONLY (Process Layer)
â”‚   â”‚   â”œâ”€â”€ AGENT_ARCHITECTURE.md  â† í˜„ì¬ ë¬¸ì„œ
â”‚   â”‚   â”œâ”€â”€ DOCUMENT_PIPELINE.md
â”‚   â”‚   â”œâ”€â”€ SYSTEM_MANIFEST.md
â”‚   â”‚   â””â”€â”€ PRD_GUIDE.md
â”‚   â”‚
â”‚   â”œâ”€â”€ context/ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ğŸ”´ READ ONLY (Philosophy Layer)
â”‚   â”‚   â”œâ”€â”€ AI_Playbook.md
â”‚   â”‚   â””â”€â”€ AI_CONTEXT.md
â”‚   â”‚
â”‚   â”œâ”€â”€ project/ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ğŸŸ¢ WRITABLE (Leaderë§Œ)
â”‚   â”‚   â”œâ”€â”€ PRD.md
â”‚   â”‚   â””â”€â”€ PROJECT_STACK.md
â”‚   â”‚
â”‚   â””â”€â”€ state/ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ğŸŸ¢ ìë™ ì—…ë°ì´íŠ¸
â”‚       â””â”€â”€ handoff-status.json
â”‚
â”œâ”€â”€ orchestrator/ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ğŸ›ï¸ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´í„°
â”‚   â”œâ”€â”€ orchestrator.js      # ë©”ì¸ ì œì–´
â”‚   â”œâ”€â”€ index.js             # CLI ì—”íŠ¸ë¦¬í¬ì¸íŠ¸
â”‚   â”‚
â”‚   â”œâ”€â”€ agents/
â”‚   â”‚   â”œâ”€â”€ leader.js        # Leader Agent
â”‚   â”‚   â”œâ”€â”€ subagent.js      # Sub-agent
â”‚   â”‚   â”œâ”€â”€ analysis-agent.js # AnalysisAgent
â”‚   â”‚   â”œâ”€â”€ prd-analyzer.js  # PRD Gap Check
â”‚   â”‚   â””â”€â”€ output-validator.js # ì‚°ì¶œë¬¼ ê²€ì¦
â”‚   â”‚
â”‚   â”œâ”€â”€ skills/              # Skill ì •ì˜ (v2.5.0 ë„¤ì´ë°)
â”‚   â”‚   â”œâ”€â”€ query/           # SQL ì¿¼ë¦¬ ìƒì„±
â”‚   â”‚   â”œâ”€â”€ profiler/        # í”„ë¡œíŒŒì¼ ë¶„ì„
â”‚   â”‚   â”œâ”€â”€ designer/        # ì‹œê°í™” (MDâ†’HTML)
â”‚   â”‚   â”œâ”€â”€ doc-sync/        # Notion ë™ê¸°í™”
â”‚   â”‚   â”œâ”€â”€ coder/           # ì½”ë“œ êµ¬í˜„
â”‚   â”‚   â”œâ”€â”€ reviewer/        # í’ˆì§ˆ ê²€ì¦
â”‚   â”‚   â””â”€â”€ viewer/          # ì›¹ ë·°ì–´ API
â”‚   â”‚
â”‚   â”œâ”€â”€ providers/           # Multi-LLM Provider
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚
â”‚   â””â”€â”€ utils/               # ìœ í‹¸ë¦¬í‹°
â”‚       â””â”€â”€ ...
â”‚
â”œâ”€â”€ workspace/
â”‚   â”œâ”€â”€ logs/                # ì‹¤í–‰ ë¡œê·¸ âœ…
â”‚   â””â”€â”€ sessions/            # ì„¸ì…˜ ë°ì´í„°
â”‚
â”œâ”€â”€ docs/cases/{caseId}/     # ì¼€ì´ìŠ¤ë³„ ì‚°ì¶œë¬¼ (í†µí•©)
â”‚   â”œâ”€â”€ PRD.md               # ìŠ¤ëƒ…ìƒ·
â”‚   â”œâ”€â”€ IA.md
â”‚   â”œâ”€â”€ SDD.md
â”‚   â”œâ”€â”€ HANDOFF.md
â”‚   â””â”€â”€ analysis/            # ë¶„ì„ ê²°ê³¼
â”‚
â”œâ”€â”€ backend/src/             # ë°±ì—”ë“œ API
â”‚
â””â”€â”€ frontend/src/            # í”„ë¡ íŠ¸ì—”ë“œ
```

---

## 8. ì‚¬ìš©ë²•

### 8.1 ê¸°ë³¸ ì‹¤í–‰

```bash
# ê¸°ë³¸ ì‚¬ìš©
node orchestrator/index.js "ë¡œê·¸ì¸ ê¸°ëŠ¥ êµ¬í˜„"

# PRD ê¸°ë°˜ êµ¬í˜„
node orchestrator/index.js --prd docs/PRD.md "ê¸°ëŠ¥ êµ¬í˜„"

# Dry-run (íŒŒì¼ ì €ì¥ ì—†ì´)
node orchestrator/index.js --no-save "í…ŒìŠ¤íŠ¸ ì‘ì—…"
```

### 8.2 ì˜µì…˜

| ì˜µì…˜                | ì„¤ëª…             | ê¸°ë³¸ê°’             |
| ------------------- | ---------------- | ------------------ |
| `--prd <path>`      | PRD íŒŒì¼ ê²½ë¡œ    | -                  |
| `--task-id <id>`    | ì‘ì—… ID ì§€ì •     | `task-{timestamp}` |
| `--no-save`         | íŒŒì¼ ì €ì¥ ì•ˆ í•¨  | false              |
| `--max-retries <n>` | ìµœëŒ€ ì¬ì‹œë„ íšŸìˆ˜ | 3 (ìƒí•œ 5)         |

### 8.3 í™˜ê²½ ì„¤ì •

```bash
# orchestrator/.env
ANTHROPIC_API_KEY="sk-ant-..."
OPENAI_API_KEY="sk-..."           # Optional (Fallback)
GOOGLE_API_KEY="..."              # Optional (Fallback)

ANTHROPIC_MODEL="claude-sonnet-4-20250514"
MAX_RETRIES=3
```

---

## 9. ë©”íŠ¸ë¦­ ì¶”ì 

OrchestratorëŠ” ë‹¤ìŒ ë©”íŠ¸ë¦­ì„ ìë™ ì¶”ì í•©ë‹ˆë‹¤:

| ë©”íŠ¸ë¦­               | ì„¤ëª…                                     |
| -------------------- | ---------------------------------------- |
| **ì´ ì†Œìš” ì‹œê°„**     | ì „ì²´ ì‘ì—… ì™„ë£Œê¹Œì§€ ê±¸ë¦° ì‹œê°„             |
| **ë‹¨ê³„ë³„ ì†Œìš” ì‹œê°„** | Planning, Coding, Review ê° ë‹¨ê³„         |
| **í† í° ì‚¬ìš©ëŸ‰**      | Leader/Sub-agent ì…ë ¥/ì¶œë ¥ í† í°          |
| **ì¬ì‹œë„ íšŸìˆ˜**      | Review FAILë¡œ ì¸í•œ ì¬ì‹œë„                |
| **Provider ì‚¬ìš©**    | ì–´ë–¤ LLM Providerê°€ ì‚¬ìš©ë˜ì—ˆëŠ”ì§€         |
| **ë³´ì•ˆ ì´ë²¤íŠ¸**      | Path Traversal, Prompt Injection ì‹œë„ ë“± |

ë¡œê·¸ ì¶œë ¥:

```
workspace/logs/<task-id>.json          # ì‹¤í–‰ ë©”íŠ¸ë¦­
workspace/logs/audit/audit-*.jsonl     # ë³´ì•ˆ ê°ì‚¬ ë¡œê·¸
```

---

## 10. ì¬ì‹œë„ ì •ì±…

| ìƒí™©                   | ë™ì‘                        |
| ---------------------- | --------------------------- |
| Review PASS            | ì‘ì—… ì™„ë£Œ                   |
| Review FAIL (1~4íšŒ)    | í”¼ë“œë°± ë°˜ì˜ í›„ ì¬ì‹œë„       |
| Review FAIL (5íšŒ ì´ˆê³¼) | ì‘ì—… ì¤‘ë‹¨, ì‚¬ìš©ì ê°œì… ìš”ì²­ |
| API ì—ëŸ¬               | Fallback Provider ì‹œë„      |
| ëª¨ë“  Provider ì‹¤íŒ¨     | ì—ëŸ¬ ë¡œê·¸ ê¸°ë¡, ì‘ì—… ì¤‘ë‹¨   |

---

## ğŸ“š ê´€ë ¨ ë¬¸ì„œ

| ë¬¸ì„œ                     | ì—­í•                      |
| ------------------------ | ------------------------ |
| `CLAUDE.md`              | íŒ€ í—Œë²•, Safety Rules    |
| `VALIDATION_GUIDE.md`    | Leaderì˜ ê²€ì¦ ê¸°ì¤€       |
| `DOMAIN_SCHEMA.md`       | ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ      |
| `orchestrator/README.md` | Orchestrator ìƒì„¸ ê°€ì´ë“œ |

---

## ğŸ“ ë³€ê²½ ì´ë ¥

| ë²„ì „  | ë‚ ì§œ       | ë³€ê²½ ë‚´ìš©                                                                      |
| ----- | ---------- | ------------------------------------------------------------------------------ |
| 2.6.2 | 2025-12-24 | Phase A ë‹¤ì´ì–´ê·¸ë¨ ìˆ˜ì •: Reviewer Skill ìœ„ì¹˜ë¥¼ Query Skill ì§í›„ë¡œ ì´ë™, ì¿¼ë¦¬ ê²°ê³¼ ê²€ì¦ í›„ ë¦¬í¬íŠ¸ ìƒì„± íë¦„ìœ¼ë¡œ ë³€ê²½ |
| 2.6.1 | 2025-12-24 | Agent-Skill ê¶Œí•œ ë§¤íŠ¸ë¦­ìŠ¤ ì—…ë°ì´íŠ¸: Leaderâ†’reviewer, SubAgentâ†’doc-sync, User(HITL)â†’viewer ì¶”ê°€, ì‚¬ìš© ì‹œì  ì„¤ëª… ì¶”ê°€ |
| 2.6.0 | 2025-12-24 | ê³µí†µ Skill (Reviewer, Viewer, Doc-Sync) í‘œ ì¶”ê°€, ë‹¤ì´ì–´ê·¸ë¨ì— Cross-Phase Skill íë¦„ ë°˜ì˜ (HITLâ†”Viewer, í’ˆì§ˆê²€ì¦â†”Reviewer, Phaseì™„ë£Œâ†”Doc-Sync) |
| 2.5.1 | 2025-12-24 | Phase í‘œ Agent/Skill ë¶„ë¦¬, Mermaid ë‹¤ì´ì–´ê·¸ë¨ Skill ì°¸ì¡° ìˆ˜ì •, ì„¹ì…˜ 3.4 queryâ†’Query Skill ì—…ë°ì´íŠ¸ |
| 2.5.0 | 2025-12-24 | Skill ë„¤ì´ë° ë¦¬íŒ©í† ë§: agent ì ‘ë¯¸ì‚¬ ì œê±° (query-agentâ†’query, code-agentâ†’coder ë“±), ì‹œìŠ¤í…œ ë‹¤ì´ì–´ê·¸ë¨ Skill ì—…ë°ì´íŠ¸ |
| 2.4.0 | 2025-12-24 | ë¬¸ì„œ ì •ë¦¬: ì„¹ì…˜2 ì¤‘ë³µ ì œê±°, íŒŒì¼êµ¬ì¡° ATO-System-Bë¡œ ìˆ˜ì •, ë¡œê·¸ê²½ë¡œ workspace/logsë¡œ ìˆ˜ì •, QUALITY_GATESâ†’VALIDATION_GUIDE ìˆ˜ì • |
| 2.3.0 | 2025-12-24 | AnalysisAgent ì—­í•  ê³µì‹í™” (ì„¹ì…˜ 3.4), Skill-Agent ë§¤í•‘ í…Œì´ë¸” ì¶”ê°€ (ì„¹ì…˜ 0.6), Phase ê¸°ë°˜ íŒŒì´í”„ë¼ì¸ í˜„í–‰í™” |
| 2.0.0 | 2025-12-19 | Agent ë¡œë”© ì„¤ì • ì„¹ì…˜ ì¶”ê°€ (ì„¹ì…˜ 0), ì„¹ì…˜ë³„ ì„ íƒì  ë¡œë”© ì „ëµ                    |
| 1.8.0 | 2025-12-17 | Output Validation â†’ Review ì—°ë™, 3ë‹¨ê³„ PRD ë§¤ì¹­                                |
| 1.7.0 | 2025-12-17 | MCP ì œê±°, Orchestrator ì¤‘ì‹¬ ì•„í‚¤í…ì²˜, Multi-LLM Provider                       |

---

**END OF AGENT_ARCHITECTURE.md**
